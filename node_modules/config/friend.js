var crypto = require('crypto'); 
var rand = require('csprng'); 
var mongoose = require('mongoose'); 
var user = require('config/models');  

exports.add_friend = function(m_username, f_username, callback) {
    user.find({username: m_username}, function(err, users) {
        if (users.length != 0) {
            var me = users[0];
            
            user.find({username: f_username}, function(err, fusers) {
                if (fusers.length != 0) {
                    var person = fusers[0];
                    
                    if (me.friends.indexOf(f_username) == -1) {
                        me.friends.push(f_username);
                        me.save();
                        person.friends.push(m_username);
                        person.save();
                        
                        callback({'response': "Add Friend Success", 'res': true});
                    } else {
                        callback({'response': "Already had friend " + f_username, 'res': false});
                    }
                    
                } else {
                    callback({'response': "Cannot find user " + f_username, 'res': false});
                }
            });
            
        } else {
            callback({'response': "Error while adding friend", 'res': false});
        }
    });
}

exports.get_friends = function(id, callback) {
    user.find({token: id}, function(err, users) {
        if (users.length != 0) {
            var friends = users[0].friends;
            callback({'response': "Get Friends List", 'res': true, 'friends': friends});
        } else {
            callback({'response': "Error while getting friends", 'res': false});
        }
    });
}