var mongoose = require('mongoose'); 
var user = require('config/models'); 

exports.rate = function(username, rater, rateStr, callback) {
    user.find({username: rater}, function(err, users) {
        if (users.length != 0) {
            user.find({username: username}, function(err, users2) {
                if (users2.length != 0) {
                    var user = users2[0];
                    var rateFloat = parseFloat(rateStr);
                    user.rateTotal += rateFloat;
                    user.rateNum += 1;
                    user.save();
                    callback({'response': "Update rate success", 'res': true});
                } else {
                    callback({'response': "Cannot find user being rated", 'res': false});
                }
            });
        } else {
            callback({'response': "Cannot find user being rating", 'res': false});
        }
        
    });
};

exports.getRateFloat = function(username, callback) {
    user.find({username: username}, function(err, users) {
        if (users.length != 0) {
            var rateFloat = Math.round((users[0].rateTotal / users[0].rateNum) * 10) / 10;
            callback({'rate': rateFloat, 'res': true});
        } else {
            callback({'response': "Cannot find user", 'res': false});
        }
    });
};